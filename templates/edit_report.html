<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRa9yAaau5PhnGM0szW4OI5D7_QsPmjbk&libraries=places"></script>
</head>
<body>

    {% include 'navbar.html' %}

    <div class="container mt-5">
        <h2>Edit Report</h2>

        <form method="POST">
            <div class="mb-3">
                <label for="name" class="form-label">Report Name</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ report.name }}" required>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" required>{{ report.description }}</textarea>
            </div>

            <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-control" id="category" name="category" required>
                    <option value="Incident" {% if report.category == "Incident" %} selected {% endif %}>Incident</option>
                    <option value="Crime" {% if report.category == "Crime" %} selected {% endif %}>Crime</option>
                    <option value="Accident" {% if report.category == "Accident" %} selected {% endif %}>Accident</option>
                    <option value="Fire" {% if report.category == "Fire" %} selected {% endif %}>Fire</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <input type="text" class="form-control" id="address" name="address" placeholder="Enter address" value="{{ report.address }}">
            </div>

            <div class="mb-3">
                <label for="longitude" class="form-label">Longitude</label>
                <input type="text" class="form-control" id="longitude" name="longitude" value="{{ report.longitude }}" readonly>
            </div>

            <div class="mb-3">
                <label for="latitude" class="form-label">Latitude</label>
                <input type="text" class="form-control" id="latitude" name="latitude" value="{{ report.latitude }}" readonly>
            </div>

            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </div>

    <script>
        // Initialize the Google Maps Geocoder
        function initGeocoder() {
            const geocoder = new google.maps.Geocoder();
            const addressInput = document.getElementById('address');

            addressInput.addEventListener('blur', function() {
                const address = addressInput.value;

                if (address) {
                    geocoder.geocode({'address': address}, function(results, status) {
                        if (status === 'OK') {
                            const location = results[0].geometry.location;
                            const lat = location.lat();
                            const lng = location.lng();

                            // Populate the longitude and latitude fields
                            document.getElementById('latitude').value = lat;
                            document.getElementById('longitude').value = lng;
                        } else {
                            alert("Geocode was not successful for the following reason: " + status);
                        }
                    });
                }
            });
        }

        // Load the geocoder when the page is ready
        window.onload = initGeocoder;
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
